apt update && apt install snapd nload htop supervisor -y 
snap install core
snap install shadowsocks-libev --edge
systemctl enable --now supervisor
cat >>/var/snap/shadowsocks-libev/common/etc/shadowsocks-libev/config.json<<EOF
{
    "server":"0.0.0.0",
    "mode":"tcp_and_udp",
    "server_port":9999,
    "local_port":1080,
    "password":"password",
    "timeout":60,
    "method":"chacha20-ietf"
}
EOF
cat >>/etc/supervisor/conf.d/shadowsocks-libev.conf<<EOF
[program:shadowsocks]
priority=1
command=/usr/bin/snap run shadowsocks-libev.ss-server -c /var/snap/shadowsocks-libev/common/etc/shadowsocks-libev/config.json
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/shadowsocks.log
EOF
supervisorctl update
cd /opt && mkdir -p kcptun udp2raw
cd kcptun
wget https://github.com/xtaci/kcptun/releases/download/v20210103/kcptun-linux-amd64-20210103.tar.gz
tar -xzvf kcptun-linux-amd64-20210103.tar.gz
cd ../udp2raw
wget https://github.com/wangyu-/udp2raw-tunnel/releases/download/20200818.0/udp2raw_binaries.tar.gz
tar -xzvf udp2raw_binaries.tar.gz
cat >> /etc/supervisor/conf.d/kcptun.conf<<EOF
[program:kcptun]
priority=1
directory=/opt/kcptun
command=/opt/kcptun/server_linux_amd64 -t "127.0.0.1:9999" -l "127.0.0.1:7777" -mode manual -nodelay 1 -interval 20 -resend 2 -nc 1 --sndwnd 4096  --rcvwnd 4096  -mtu 1300  --nocomp  --ds 30 --ps 15  --crypt none
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/kcptun.log
EOF
supervisorctl update
cat >> /etc/supervisor/conf.d/udp2raw.conf<<EOF
[program:udp2raw]
priority=1
directory=/opt/udp2raw
command=/opt/udp2raw/udp2raw_amd64 -s -l 0.0.0.0:6666 -r 127.0.0.1:7777 --raw-mode faketcp --cipher-mode none -a -k "password"
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/udp2raw.log
EOF
supervisorctl update
